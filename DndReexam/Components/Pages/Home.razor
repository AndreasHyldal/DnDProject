@page "/home"
@inject WorktimeService WorktimeService
@inject AuthService AuthService
@inject IJSRuntime JS
@using MudBlazor

<PageTitle>Home</PageTitle>

@if (worktimeSummary == null || worktimeRaw == null)
{
    <MudProgressCircular Indeterminate="true" />
}
else
{
    <div class="grid-container">
        <!-- First Row -->
        <div class="first-row main-content">
            <WorktimeChart
                Series="@chartSeries" 
                Labels="@chartLabels" 
                Width="100%" 
                Height="350px"
            />
        </div>
        <div class="first-row side-content">
            Sidebar (20%)
        </div>

        <!-- Second Row -->
        <div class="second-row">
            <table class="table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th aria-label="Start time">Start</th>
                        <th aria-label="End time">End</th>
                        <th>Task</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var workRecord in worktimeRaw)
                    {
                        <tr>
                            <td>@(workRecord.Start.ToString("yyyy-MM-dd"))</td>
                            <td>@(workRecord.Start.ToString("HH:mm"))</td>
                            <td>@(workRecord.End.ToString("HH:mm"))</td>
                            <td>@workRecord.Task</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}

@code {
    private List<WorktimeSummary>? worktimeSummary;
    private List<WorktimeRaw>? worktimeRaw;
    private int employeeId = 1;
    private string[] chartLabels = Array.Empty<string>();
    private List<ChartSeries> chartSeries = new();
    private string token;


    @* protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            token = await AuthService.GetTokenAsync();
            worktimeSummary = await WorktimeService.GetWorktimeSummaryAsync(employeeId);
            worktimeRaw = await WorktimeService.GetWorktimeRawAsync(employeeId, token);

            // Now retrieve worktime data using the token

            if (worktimeSummary is { Count: > 0 })
            {
                // Build labels for the X-Axis from the summary dates
                chartLabels = worktimeSummary.Select(x => x.Date).ToArray();

                // Prepare the chart series data (e.g., total hours worked)
                var totalHoursData = worktimeSummary.Select(x => x.TotalHours).ToArray();

                chartSeries = new List<ChartSeries>
                {
                    new ChartSeries
                    {
                        Name = "Worktime",
                        Data = totalHoursData
                    }
                };
            }

            await base.OnAfterRenderAsync(firstRender);
    } *@
    

        
    }

